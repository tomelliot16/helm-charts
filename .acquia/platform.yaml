apiVersion: v1  # This informs what versions of ak8s this file is compatible with
service: stormforge
project: sre
owner: devops
base:
  # Bootstrap
  standard:
    type: bootstrap
    version: v0.8.0
    values:
      syncPolicy:
        automated:
          prune: true
          allowEmpty: true
      clusterTypes:
        - "internal"
        - "polaris"
      targetNamespace: stormforge-system
      repoURL: https://github.com/acquia/sre-stormforge
      path: charts/optimize-live

variants:
  - name: dev
    overrides:
      standard:
        values:
          valueFiles:
            - values.yaml
          targetRevision: &dev-version DEVOPS-2409
          component:
            image:
              controller:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/controller
                tag: *dev-version
              tsdb:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/tsdb
                pullPolicy: Always
                tag: *dev-version
              applier:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/applier
                tag: *dev-version
              recommender:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/recommender
                tag: *dev-version
              grafana:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/grafana-oss
                tag: *dev-version
          # clusterOverrides:
          #   - selectorLabels:
          #     - key: name
          #       value: ngcweb-loki1c6bb4
          #     targetRevision: integration-tests
  - name: staging
    overrides:
      standard:
        values:
          valueFiles:
            - values.yaml
          targetRevision: &staging-version v1.1.1
          component:
            image:
              controller:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/controller
                tag: *staging-version
              tsdb:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/tsdb
                pullPolicy: Always
                tag: *staging-version
              applier:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/applier
                tag: *staging-version
              recommender:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/recommender
                tag: *staging-version
              grafana:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/grafana-oss
                tag: *staging-version
