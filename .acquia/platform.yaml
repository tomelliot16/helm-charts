apiVersion: v1  # This informs what versions of ak8s this file is compatible with
service: stormforge
project: sre
owner: devops
base:
  # Bootstrap
  standard:
    type: bootstrap
    version: v0.8.1
    values:
      syncPolicy:
        automated:
          prune: true
          allowEmpty: true
      clusterTypes:
        - "internal"
        - "polaris"
      targetNamespace: stormforge-system
      repoURL: https://github.com/acquia/sre-stormforge
      path: charts/optimize-live

variants:
  - name: dev
    overrides:
      standard:
        values:
          valueFiles:
            - values.yaml
          targetRevision: &dev-version main
          component:
            image:
              controller:
                repository: jfrog.ais.acquia.io/devops-pipeline-dev/stormforge/controller
                tag: *dev-version
              tsdb:
                repository: jfrog.ais.acquia.io/devops-pipeline-dev/stormforge/tsdb
                pullPolicy: Always
                tag: *dev-version
              applier:
                repository: jfrog.ais.acquia.io/devops-pipeline-dev/stormforge/applier
                tag: *dev-version
              recommender:
                repository: jfrog.ais.acquia.io/devops-pipeline-dev/stormforge/recommender
                tag: *dev-version
              grafana:
                repository: jfrog.ais.acquia.io/devops-pipeline-dev/stormforge/grafana-oss
                tag: *dev-version
          #--- Uncomment section if testing in a PR ---#
          #
          # clusterOverrides:
          #   - selectorLabels:
          #     - key: name
          #       value: csd-hades82db9
          #     targetRevision: MY-PR-BRANCH
          #
          #-- Avoid electro, loki, or uguisud in PRs --#

- name: qa
    overrides:
      standard:
        values:
          valueFiles:
            - values.yaml
          targetRevision: &qa-version v1.1.2
          component:
            image:
              controller:
                repository: jfrog.ais.acquia.io/devops-pipeline-qa/stormforge/controller
                tag: *qa-version
              tsdb:
                repository: jfrog.ais.acquia.io/devops-pipeline-qa/stormforge/tsdb
                pullPolicy: Always
                tag: *qa-version
              applier:
                repository: jfrog.ais.acquia.io/devops-pipeline-qa/stormforge/applier
                tag: *qa-version
              recommender:
                repository: jfrog.ais.acquia.io/devops-pipeline-qa/stormforge/recommender
                tag: *qa-version
              grafana:
                repository: jfrog.ais.acquia.io/devops-pipeline-qa/stormforge/grafana-oss
                tag: *qa-version

- name: staging
    overrides:
      standard:
        values:
          valueFiles:
            - values.yaml
          targetRevision: &staging-version v1.1.2
          component:
            image:
              controller:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/controller
                tag: *staging-version
              tsdb:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/tsdb
                pullPolicy: Always
                tag: *staging-version
              applier:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/applier
                tag: *staging-version
              recommender:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/recommender
                tag: *staging-version
              grafana:
                repository: jfrog.ais.acquia.io/devops-pipeline-staging/stormforge/grafana-oss
                tag: *staging-version
